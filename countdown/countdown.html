<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>MoN Takanawa: The Museum of Narratives - Countdown</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            /* font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans", sans-serif; */
            /* font-family: "Noto Sans JP", sans-serif; */
        }

        canvas {
            display: block;
        }
    </style>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script> -->
    <script src="../p5.min.js"></script>
</head>

<body>
    <script>
        let targetDate;
        let bubbles = [];
        const themeColors = [
            [255, 0, 0],     // #FF0000 
            [106, 208, 116], // #6AD074 
            [0, 28, 176]     // #001CB0 
        ];

        function setup() {
            createCanvas(windowWidth, windowHeight);
            targetDate = new Date(2026, 2, 27, 0, 0, 0);

            // drawingContext.shadowBlur = 0;
            // drawingContext.shadowColor = 'black';

            const now = new Date();
            const diffMs = targetDate - now;
            const dayMs = 1000 * 60 * 60 * 24;
            let daysLeft = Math.ceil(diffMs / dayMs);
            if (daysLeft < 0) daysLeft = 0;

            // 
            for (let i = 0; i < daysLeft; i++) {
                let colorChoice;
                const rand = random(1);
                if (rand < 0.90) {
                    // 90%
                    colorChoice = random(themeColors);
                } else {
                    // 10%
                    const gray = random(100, 180);
                    colorChoice = [gray, gray, gray];
                }

                bubbles.push({
                    x: random(width),
                    y: random(height),
                    r: random(30, 300),
                    vx: random(-0.5, 0.5),
                    vy: random(-0.5, 0.5),
                    alpha: random(100, 250),
                    color: colorChoice
                });
            }
            textAlign(CENTER, CENTER);
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }

        function drawBackground() {
            noStroke();
            for (let b of bubbles) {
                fill(b.color[0], b.color[1], b.color[2], b.alpha);
                ellipse(b.x, b.y, b.r, b.r);
                b.x += b.vx;
                b.y += b.vy;
                if (b.x < -b.r) b.x = width + b.r;
                if (b.x > width + b.r) b.x = -b.r;
                if (b.y < -b.r) b.y = height + b.r;
                if (b.y > height + b.r) b.y = -b.r;
            }
        }

        function draw() {
            drawingContext.shadowBlur = 0;
            drawingContext.shadowColor = 'black';

            background(0);
            drawBackground();

            const now = new Date();
            const diffMs = targetDate - now;
            const dayMs = 1000 * 60 * 60 * 24;
            let daysLeft = Math.ceil(diffMs / dayMs);
            if (daysLeft < 0) daysLeft = 0;
            const weeksLeft = (daysLeft / 7).toFixed(1);

            const baseSize = min(width, height);
            const cx = width / 2;

            // 背景を半透明で上書きして残像効果
            fill(0, 140);
            rect(0, 0, width, height);

            // noStroke();
            fill(230);

            // drawingContext.shadowOffsetX = 0;
            // drawingContext.shadowOffsetY = 0;
            drawingContext.shadowBlur = 50;
            drawingContext.shadowColor = 'black';


            textSize(baseSize * 0.05);
            text("MoN Takanawa:", cx, baseSize * 0.15);
            text("The Museum of Narratives", cx, baseSize * 0.22);
            text("開館まで", cx, baseSize * 0.30);

            textSize(baseSize * 0.12);
            text(`${daysLeft}`, cx, baseSize * 0.45);

            textSize(baseSize * 0.08);
            text(`${weeksLeft}`, cx, baseSize * 0.58);

            textSize(baseSize * 0.06);
            text(`days`, cx + baseSize * 0.25, baseSize * 0.45);
            text(`weeks`, cx + baseSize * 0.27, baseSize * 0.58);
        }
    </script>
</body>

</html>